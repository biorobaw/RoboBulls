#include "communication/kfball.h"

KFBall::KFBall():a(-3), T(0.03)
{
    //setDim(x, u, w, z, v)
    setDim(6, 2, 2, 2, 2);
}

void KFBall::makeProcess()
{
    Vector x_(x.size());
    // stop_x, vel_x, pos_x, stop_y, vel_y, pos_y
    x_(1) = x(3) + x(2)*x(2)/(2*fabs(a));
    x_(2) = x(2) + a * T;
    x_(3) = x(3) + x(2) * T;
    x_(4) = x(6) + x(5)*x(5)/(5*fabs(a));
    x_(5) = x(5) + a * T;
    x_(6) = x(6) + x(5) * T;
    x.swap(x_);
}

void KFBall::makeMeasure()
{
    z(1)= x(3);
    z(2)= x(6);
}

void KFBall::makeA()
{
    A(1,1) = 0.0;
    A(1,2) = x(2)/fabs(a);
    A(1,3) = 1.0;
    A(1,4) = 0.0;
    A(1,5) = 0.0;
    A(1,6) = 0.0;

    A(2,1) = 0.0;
    A(2,2) = 1.0;
    A(2,3) = 0.0;
    A(2,4) = 0.0;
    A(2,5) = 0.0;
    A(2,6) = 0.0;

    A(3,1) = 0.0;
    A(3,2) = T;
    A(3,3) = 1.0;
    A(3,4) = 0.0;
    A(3,5) = 0.0;
    A(3,6) = 0.0;

    A(4,1) = 0.0;
    A(4,2) = 0.0;
    A(4,3) = 0.0;
    A(4,4) = 0.0;
    A(4,5) = x(5)/fabs(a);
    A(4,6) = 1.0;

    A(5,1) = 0.0;
    A(5,2) = 0.0;
    A(5,3) = 0.0;
    A(5,4) = 0.0;
    A(5,5) = 1.0;
    A(5,6) = 0.0;

    A(6,1) = 0.0;
    A(6,2) = 0.0;
    A(6,3) = 0.0;
    A(6,4) = 0.0;
    A(6,5) = T;
    A(6,6) = 1.0;
}

void KFBall::makeW()
{
    W(1,1) = 0.0;
    W(1,2) = 0.0;
    W(2,1) = 1.0;
    W(2,2) = 0.0;
    W(3,1) = 0.0;
    W(3,2) = 0.0;
    W(4,1) = 0.0;
    W(4,2) = 0.0;
    W(5,1) = 0.0;
    W(5,2) = 1.0;
    W(6,1) = 0.0;
    W(6,2) = 0.0;
}

void KFBall::makeQ()
{
    Q(1,1) = 100.0;
    Q(1,2) = 0.0;
    Q(2,1) = 0.0;
    Q(2,2) = 100.0;
}

void KFBall::makeH()
{
    H(1,1) = 0.0;
    H(1,2) = 0.0;
    H(1,3) = 1.0;
    H(1,4) = 0.0;
    H(1,5) = 0.0;
    H(1,6) = 0.0;

    H(2,1) = 0.0;
    H(2,2) = 0.0;
    H(2,3) = 0.0;
    H(2,1) = 0.0;
    H(2,2) = 0.0;
    H(2,3) = 1.0;
}

void KFBall::makeV()
{
    V(1,1) = 1.0;
    V(1,2) = 0.0;
    V(2,1) = 0.0;
    V(2,2) = 1.0;
}

void KFBall::makeR()
{
    R(1,1) = 10.0;
    R(1,2) = 0.0;
    R(2,1) = 0.0;
    R(2,2) = 10.0;
}
